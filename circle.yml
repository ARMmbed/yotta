dependencies:
  pre:
    # setup ssh so that yotta doesn't prompt for authn
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - echo -e 'Host bitbucket.org\n\tStrictHostKeyChecking no\n' >> ~/.ssh/config

    # set up yotta registry login so that yotta doesn't prompt for authn:
    mkdir -p ~/.yotta
    chmod 600 ~/.yotta
    echo -e '{\n  "keys": {\n    "private": "-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCeWgSzCUjNdNvi\\nWXwNRG6iVFLnLKQDDC2xpn7jESku2K9TqjYWtgZaI3SwjWc0pZPZeZZ5495LA6we\\nWsyACGr9hg4q7XLfdTwdMG52qSNc3/76k2y8AQh3xRGmMbTuB/IFvxFz3XDXdsyx\\n79P/yg4N07ckP+AVcpyxFQsf+otpagVUiT2qwHbPHyBhcHlSXPcmNdZaywtkzUF4\\nrSbGXp7tpfXL9L+2WHqE+UmDe+0aRW2NJqjmBxSdNJXoYwYinqItavHmpYrRfKgo\\naLxZqLKAWFIIlp6bTo3b1kzNFOCIVb+fvS8oycPhCeI817ZIvs7eyoL2mFYJHMhN\\nBPH1dOvDAgMBAAECggEBAIjOZLj5EHjQuRd5D/+2W47LI0SuAJTRdLjCi2VJcjcS\\n5YZ2y3wbjqlZcHsH715AnteIgESWZXqRlaYz8/G5VBXsN1lHA7Oi6WieaxEBV5fp\\nvbRmoc5bZiFzlKfs0c/D9YiZZk6fxdmgvYANHy8iNboka1laBhMBjfY/o/jg0Ikk\\nv7TKKxtUOMv9mhS4eK5uXPvHVA6wFu2ZKKr3hMlLrnMsyoUVhb2W9t/FNIi0L70y\\nn6Y6pUOQN8nDOTn15KJHVv1qkhOzyMXdtzXbnDjqtgkkx6fvByzqFgg1w6dCvvkw\\nLrvru7GLR+5acbrwn/1KiY2gDpVNAm9BN3behjU24SECgYEAzZyFryQ4eEAlhXYm\\nGNZ82eu4Zt0fKpBVY5QiVR/I9iUslDbiUhs9XfPJ5cZSrGpNKx++GDUAZMAFDRDU\\n+cVh18v8ItNeqGOISmDb6x6cQ0ZoDprWB88Wwy+fSBGtb8AyeyOvQUSweoMnrSWd\\n3FQriYWGNfwz/GO1d4uqqT4AHiUCgYEAxSiNJsxqpByumGUMbYKpbSN3O6F2P1rq\\nUc1R1Sx4JRud1Xcxz9Bmj+dqlP7BAYbQijkPBrm38hooA/sPh1OduRZjncOVdrkW\\npsriFLkp2KEROsfXj8fjyhVmqADOJ+8LH64fOIGE+p16wg+Qr0PVIBeEz4fy61LP\\nCp6Qt2tGeccCgYAYEDd9Feod+LPreLZgtcmK35GHSF27Z4T20IFsIPouBI/BEONP\\n5Kw78KoyYBGQ6Cf74g0nXBydrfNpYgzq5nTbAp6RnNc5Mdzjh451Z/G11embu/dM\\nlqn9Ufd8QcVgjMfbrYN3Sgi1beAY3YwqGxe1UpEwhEG5ShoU0Z25jO4KmQKBgDAL\\n4NIasMZLoxTKU0wAso9BPFZQ08M+wamrsoyTqLfKUh1qTb5KGCRrjeK/boOTuhBl\\nNU87RSN/0k6eCTu+Wcp4NVCGEE99bZK6EHxiX1tGbS948gQ8/zsJGhpJD/RVYc2X\\nnk4j6ic052yRZH4Bttd6Q8hbZgyJAqGg4L2CLAuTAoGAVLqylnyyHecRbixKzmUi\\nnCesALhamVU5WtRBk/C3VDj7njcPz4WVCA4F6RgBKKtAuoYilbvN+kU0VSQNBg6n\\nOmsYlQLpVN1M0FQLhWn+66tII8E8CM0wOFMhFKcsauL9SB987bWo0jOO/Np0i0h0\\neTwN/wkYKDpZczX9Bs7MhRU=\\n-----END PRIVATE KEY-----\\n",\n    "public": "-----BEGIN PUBLIC KEY-----\\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnloEswlIzXTb4ll8DURu\\nolRS5yykAwwtsaZ+4xEpLtivU6o2FrYGWiN0sI1nNKWT2XmWeePeSwOsHlrMgAhq\\n/YYOKu1y33U8HTBudqkjXN/++pNsvAEId8URpjG07gfyBb8Rc91w13bMse/T/8oO\\nDdO3JD/gFXKcsRULH/qLaWoFVIk9qsB2zx8gYXB5Ulz3JjXWWssLZM1BeK0mxl6e\\n7aX1y/S/tlh6hPlJg3vtGkVtjSao5gcUnTSV6GMGIp6iLWrx5qWK0XyoKGi8Waiy\\ngFhSCJaem06N29ZMzRTgiFW/n70vKMnD4QniPNe2SL7O3sqC9phWCRzITQTx9XTr\\nwwIDAQAB\\n-----END PUBLIC KEY-----\\n"\n  },\n  "uuid": "657ba561-f893-48bf-bd37-4ffdc4fe0e88",\n  "mbed": {\n    "authtoken": "n7lWk3tCwD9sRUlQw3LOKmaZnplA95"\n  }\n}' > ~/.yotta/config.json

    # setup git so it doesn't prompt
    - git config --global user.email "test@yottabuild.org"
    - git config --global user.name "Yotta Travis-CI Bot"

    # get an up-to-date CMake
    - sudo apt-get remove -y cmake
    - curl -fsSL http://www.cmake.org/files/v3.2/cmake-3.2.3-Linux-i386.sh > /tmp/install-cmake.sh
    - chmod +x /tmp/install-cmake.sh
    - sudo /tmp/install-cmake.sh --prefix=/usr/local --exclude-subdir

    # install Ninja
    - sudo apt-get install ninja-build

    # we use tox to run tests:
    - pip install tox

  override:
    - pyenv local 2.7.10 3.3.3 3.4.3 3.5.0
    # pre-build the tox environments, so we can cache them:
    - tox --notest

  cache_directories:
    - ".tox"

test:
  override:
    - tox
